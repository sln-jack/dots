# Use dotfiles
set -g default-command ~/.jack/activate

# Custom prefix key
unbind C-b
set -g prefix C-s

# Vim
set -g mode-keys vi
set -g status-keys vi

# Copy mode
bind -n M-u copy-mode

# Copy mode scrolling
bind -T copy-mode-vi k  send -X cursor-up
bind -T copy-mode-vi j  send -X cursor-down
bind -T copy-mode-vi K send -X page-up
bind -T copy-mode-vi J send -X page-down
# Copy and immediately paste
bind -T copy-mode-vi S-Enter \
      send -X copy-selection-and-cancel \; \
      paste-buffer -d

# Copy mode regex searches
# Files
bind -T copy-mode-vi f send -X search-backward '[[:alnum:]_~/-]*[./][[:alnum:]_~/-]*/*'
bind -T copy-mode-vi F send -X search-forward  '[[:alnum:]_~/-]*[./][[:alnum:]_~/-]*/*'
# Git hashes
bind -T copy-mode-vi g send -X search-backward '[0-9a-fA-F]{7,64}'
bind -T copy-mode-vi G send -X search-forward  '[0-9a-fA-F]{7,64}'
# Urls
bind -T copy-mode-vi u send -X search-backward '(https?|ftp|git)://[^[:space:]]+'
bind -T copy-mode-vi U send -X search-forward  '(https?|ftp|git)://[^[:space:]]+'
# Numbers
bind -T copy-mode-vi d send -X search-backward '[0-9]+'
bind -T copy-mode-vi D send -X search-forward  '[0-9]+'
# IP addresses
bind -T copy-mode-vi i send -X search-backward '([0-9]{1,3}\.){3}[0-9]{1,3}'
bind -T copy-mode-vi I send -X search-forward  '([0-9]{1,3}\.){3}[0-9]{1,3}'

# Window switching
bind -n F8 switch-client -T switcher
bind -T switcher 1 if-shell "tmux select-window -t:=1" "" "new-window -t:=1"
bind -T switcher 2 if-shell "tmux select-window -t:=2" "" "new-window -t:=2"
bind -T switcher 3 if-shell "tmux select-window -t:=3" "" "new-window -t:=3"
bind -T switcher 4 if-shell "tmux select-window -t:=4" "" "new-window -t:=4"
bind -T switcher 5 if-shell "tmux select-window -t:=5" "" "new-window -t:=5"
bind -T switcher 6 if-shell "tmux select-window -t:=6" "" "new-window -t:=6"
bind -T switcher 7 if-shell "tmux select-window -t:=7" "" "new-window -t:=7"
bind -T switcher 8 if-shell "tmux select-window -t:=8" "" "new-window -t:=8"
bind -T switcher 9 if-shell "tmux select-window -t:=9" "" "new-window -t:=9"

# Smart keybinds with awareness of vim splits
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -t #{pane_tty} -o comm= | grep -q nvim"

# Pane switching
bind -n M-h if-shell "$is_vim" 'send-keys M-h' 'select-pane -L'
bind -n M-j if-shell "$is_vim" 'send-keys M-j' 'select-pane -D'
bind -n M-k if-shell "$is_vim" 'send-keys M-k' 'select-pane -U'
bind -n M-l if-shell "$is_vim" 'send-keys M-l' 'select-pane -R'
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane moving
bind -n M-H if-shell "$is_vim" 'send-keys M-H' 'select-pane -m; select-pane -L; swap-pane; select-pane -L; select-pane -M'
bind -n M-J if-shell "$is_vim" 'send-keys M-J' 'select-pane -m; select-pane -D; swap-pane; select-pane -D; select-pane -M'
bind -n M-K if-shell "$is_vim" 'send-keys M-K' 'select-pane -m; select-pane -U; swap-pane; select-pane -U; select-pane -M'
bind -n M-L if-shell "$is_vim" 'send-keys M-L' 'select-pane -m; select-pane -R; swap-pane; select-pane -R; select-pane -M'
bind H 'select-pane -m; select-pane -L; swap-pane; select-pane -L; select-pane -M'
bind J 'select-pane -m; select-pane -D; swap-pane; select-pane -D; select-pane -M'
bind K 'select-pane -m; select-pane -U; swap-pane; select-pane -U; select-pane -M'
bind L 'select-pane -m; select-pane -R; swap-pane; select-pane -R; select-pane -M'

# Pane resizing
bind -nr M-w if-shell "$is_vim" 'send-keys M-w' 'resize-pane -U 3'
bind -nr M-s if-shell "$is_vim" 'send-keys M-s' 'resize-pane -D 3'
bind -nr M-a if-shell "$is_vim" 'send-keys M-a' 'resize-pane -L 3'
bind -nr M-d if-shell "$is_vim" 'send-keys M-d' 'resize-pane -R 3'

# Pane splits
unbind '"'
unbind %
bind = split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind -n M-= if-shell "$is_vim" 'send-keys M-=' 'split-window -h -c "#{pane_current_path}"'
bind -n M-- if-shell "$is_vim" 'send-keys M--' 'split-window -v -c "#{pane_current_path}"'

# Quiet down
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# Mouse support
set -g mouse on

# Fix escape
set -sg escape-time 10

# More scrollback
set -g history-limit 10000

# 1-indexed windows
set -g base-index 1
set -g pane-base-index 1

# Modern niceties such as shift-enter
set -g xterm-keys on

# Theme
set-option -g clock-mode-colour "#57557f"
set-option -g message-command-style "bg=#262626,fg=#b2b2b2"
set-option -g message-style "bg=#262626,fg=#b2b2b2"
set-option -g mode-style "bg=#444444,fg=#b2b2b2"
set-option -g pane-border-style "fg=#eeeeee"
set-option -g pane-active-border-style "fg=purple"
set-option -g status-left " #S "
set-option -g status-left-style "bg=#fdab08,fg=#121212"
set-option -g status-right " #[bg=#57557f] %Y/%m/%d %a %H:%M "
set-option -g status-right-style "bg=#121212,fg=#b2b2b2"
set-option -g status-style "bg=#121212,fg=#b2b2b2"
set-option -g window-status-activity-style "bg=#121212,fg=#d75fd7"
set-option -g window-status-current-format " #I#F| #W "
set-option -g window-status-current-style "bg=#57557f,fg=#b2b2b2"
set-option -g window-status-format "#[fg=#585858] #I |#[fg=default] #W "
set-option -g window-status-separator ""
set-option -g window-status-style "bg=#121212,fg=#b2b2b2"
